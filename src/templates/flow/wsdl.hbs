// @flow
{{>wsdlDocumentation}}

{{! TODO: move to top because imports...}}
{{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'types'}}
{{{inlineSchema this}}}
{{/eachOfType}}

export type Security =Â {|
    addOptions?: ?(options: Object) => void,
    addHeaders?: ?(headers: Object) => void,
    toXML: () => string,
    postProcess?: ?(xml: string, envelopeKey: string) => string,
|};

export type Client = {|
    {{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'service'}}
    {{$.name.value}}: {{$.name.value}},
    {{/eachOfType}}

{{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'portType'}}
    {{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'operation'}}
    {{>wsdlDocumentation}}
        {{#withInputOutputAndFaults this}}
    {{>wsdlOperationSync}}
    {{>wsdlOperationAsync}}
        {{/withInputOutputAndFaults}}
    {{/eachOfType}}
{{/eachOfType}}
    {{! TODO: the other properties of a client... }}
    describe: () => Object,
    setSecurity: (security: Security) => void,
    lastRequest: Object,
    setEndpoint: (endpoint: string) => void,
    on: ((event: 'request', callback: (xml: string, eid: string) => void) => void)
        | ((event: 'message', callback: (message: string, eid: string) => void) => void)
        | ((event: 'soapError', callback: (error: Object, eid: string) => void) => void)
        | ((event: 'response', callback: (body: string, res: Object, eid: string) => void) => void),
|};

{{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'service'}}
export type {{$.name.value}} = {|
    {{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'port'}}
        {{#withPortType this}}
    {{../$.name.value}}: {{portType.$.name.value}},
        {{/withPortType}}
    {{/eachOfType}}
|};
{{/eachOfType}}

{{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'portType'}}
export type {{$.name.value}} = {|
    {{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'operation'}}
        {{>wsdlDocumentation}}
        {{#withInputOutputAndFaults this}}
        {{>wsdlOperationSync}}
        {{/withInputOutputAndFaults}}
    {{/eachOfType}}
|};
{{/eachOfType}}

{{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'message'}}
export type {{$.name.value}} = {|
    {{! TODO: Support RPC-style wsdl's that have type="" instead of element="" in the input/output definitions}}
    {{#eachOfType $children 'http://schemas.xmlsoap.org/wsdl/' 'part'}}
        {{#if $.element}}
    {{localPartNoValidation $.element.value}}: {{typeName $.element.value this}}_element,
        {{/if}}
    {{/eachOfType}}
|};
{{/eachOfType}}